!function(){var t={ns:function(t,e){var n=window;this.each(this.trim(t).split(e||"."),function(t){n[t]=n[t]||{},n=n[t]}),n=null},getNSObj:function(t){var e={};try{e=new Function("return "+t)()}catch(n){}return e},trim:function(t,e){return e=new RegExp("^"+(e||"\\s")+"+|"+(e||"\\s")+"+$","g"),t.replace(e,"")},trimLeft:function(t,e){return e=new RegExp("^"+(e||"\\s")+"+","g"),t.replace(e,"")},trimRight:function(t,e){return e=new RegExp((e||"\\s")+"+$","g"),t.replace(e,"")},removeArrayItem:function(t,e){this.each(t,function(n,r){return n===e?""+t.splice(r,1):0})},each:function(t,e){for(var n=0,r=t.length;r>n;)if(e(t[n],n++))return},foreach:function(t,e){for(var n in t)if(t.hasOwnProperty(n)&&e(n,t[n]))return},extend:function(t,e,n){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);n&&this.isFunction(e)&&(t.prototype=e.prototype)},copy:function(e){var n={};for(var r in e)("hasOwnProperty"in e&&e.hasOwnProperty(r)||t.isIE>0&&t.isIE<9)&&(n[r]=e[r]);return n},list2Array:function(t){var e;try{e=[].slice.call(t,0)}catch(n){for(var r=0,i=t.length;i>r;r++)e.push(t[i])}return e},isUndefined:function(t){return"undefined"==typeof t},isNull:function(t){return null===t},isIE:function(){var t=navigator.userAgent.match(/MSIE\s*(.*?);/i);return t?Math.round(t[1]):0}(),injectCSS2Page:function(t){var e;if(document.createStyleSheet){e=document.createStyleSheet();var n=this;this.each(t,function(t){t=n.trim(t).match(/(.+?)\{([^\}]*)\}/),3===t.length&&e.addRule(t[1],t[2])})}else{if(!(e=document.createElement("style")))throw"injectCSS2Page failed";e.type="text/css",e.innerHTML=t.join(""),document.head.appendChild(e)}},$:function(t){return document.getElementById(t)||t},formatDecimal:function(t,e){var t=String(t),n=t.indexOf(".");return-1!==n?t.substr(0,n+e+1):t},DomEvent:function(){var e=[];return window.addEventListener?{on:function(t,e,n){t.addEventListener(e,n,!1)},un:function(t,e,n){t.removeEventListener(e,n)}}:{on:function(t,n,r){t.attachEvent("on"+n,e[e.push({dom:t,type:n,callback:r,handle:function(){return r.apply(t,arguments)}})-1].handle)},un:function(n,r,i){var a;t.each(e,function(t,e){return t.dom===n&&t.type===r&&t.callback===i?(n.detachEvent("on"+r,t.handle),a=e,!0):void 0}),!t.isUndefined(a)&&e.splice(a,1)}}}(),sumArray:function(t){var e=0;return this.each(t,function(t){e+=t}),e},getMaxFromArray:function(t){return new Function("return Math.max("+(t.join()||0)+")")()},addClass:function(t,e){new RegExp("\\b"+e+"\\b").test(t.className)||(t.className=""===t.className?e:t.className+" "+e)}};t.each(["Object","Array","Boolean","Number","Function"],function(e){t["is"+e]=function(t){return Object.prototype.toString.call(t)==="[object "+e+"]"}}),t.extend(t,{domReady:function(){function e(){for(var t,e=0;t=r[e++];)t.apply(this,arguments)}var n,r=[],i=0;return window.addEventListener?t.DomEvent.on(document,"DOMContentLoaded",function(){i=1,t.DomEvent.un(document,"DOMContentLoaded",arguments.callee),e.apply(this,arguments)}):n=setInterval(function(){try{document.documentElement.doScroll("left"),i=1,e.apply(this,arguments),window.clearInterval(n)}catch(t){}}),function(t){return i||"loaded"===document.readyState||"complete"===document.readyState?t.call(document):r.push(t)}}()});var e={create:function(e){var n={};return t.foreach(e,function(t,r){e.hasOwnProperty(t)&&(n[t]=r)}),n.addListener=this.addListener,n.removeListener=this.removeListener,n.fireEvent=this.fireEvent,n.getListener=this.getListener,n},addListener:function(e,n){e=t.trim(e).split(" ");for(var r,i=0;r=e[i++];)this.getListener(r).push(n)},removeListener:function(e,n){e=t.trim(e).split(" ");for(var r,i=0;r=e[i++];)(r=this.getListener(r))&&t.removeArrayItem(r,n)},fireEvent:function(e){e=t.trim(e).split(" ");for(var n,r=0;n=e[r++];){var i,a,o=this.getListener(n);if(o)for(a=o.length;a--;)o[a]&&(i=o[a].apply(this,arguments));(i=this["on"+n.toLowerCase()])&&(i=i.apply(this,arguments))}return i},getListener:function(t){var e=this.allListeners;return t=t.toLowerCase(),e?e[t]||(this.allListeners[t]=[]):(this.allListeners={},this.allListeners[t]=[])}},n=function(){function n(t,e){for(var n=r.length;n--;)if(r[n][t]===e)return r[n]}var r=[];return e.create({version:"1.0.0",check:function(e){var i,a,o,u;for(u="string"==typeof e?t.getNSObj(t.trimRight(t.trimLeft(e,"window\\."),"\\.")):e,r.push({object:u,name:e,supCopy:null});u;){var s=n("supCopy",u);s=s?s.realSup:u,i=o=t.copy(u);for(var c in i)if("hasOwnProperty"in i&&i.hasOwnProperty(c)||t.isIE>0&&t.isIE<9){if(a=i[c],delete i[c],n("object",a))continue;if(t.isObject(a))r.push({object:a,supCopy:i,realSup:s,name:c});else{if("function"!=typeof a)continue;for(var l=[],p=n("object",s);p;)p.name&&l.unshift(p.name),p=n("object",n("supCopy",p.supCopy).realSup);r.push({object:a,supCopy:i,realSup:s,name:c,path:l.join(".")+"."+c}),this.fireEvent("function-found",r[r.length-1].path);var f=t.getNSObj(l.join("."));f[c]=this.wrapCount(a),t.extend(f[c],a,1)}i=a;break}u=o===i?n("object",s).supCopy:i}},wrapCount:function(t){var e=this;return function(){var r=n("object",t).path;e.fireEvent("before-function-exec",r,arguments,t);var i,a=+new Date;if(this.constructor===arguments.callee){for(var o=0,u=[];o<arguments.length;o++)u.push("string"==typeof arguments[o]?'"'+arguments[o]+'"':arguments[o]);i=new Function("return new fn("+u.join(",")+")")()}else i=t.apply(this,arguments);return e.fireEvent("after-function-exec",r,arguments,t,+new Date-a),i}},getShell:function(){return r}})}();window.zop=n;var r=function(){var e={};return{setInfoByPath:function(t){e[t]={runtime:[],arglist:[],caller:[]}},getInfoByPath:function(t){return t?e[t]:e},applyFormat:function(n,r){t.foreach(e,function(t,e){n[r](t,e)})},getFuncInfosLength:function(){var n=0;return t.foreach(e,function(){n++}),n}}}();n.addListener("function-found",function(t,e){r.setInfoByPath(e)}),n.addListener("before-function-exec",function(e,n,i){var a=r.getInfoByPath(n);a.runtime.push(+new Date),a.arglist.push(t.list2Array(i).join(",")),a.caller.push(i.callee.caller)}),n.addListener("after-function-exec",function(e,n,i,a,o){var u=r.getInfoByPath(n);u.runtime.push(o),u.arglist.push(t.list2Array(i).join(",")),u.caller.push(i.callee.caller)});var i={displayMaxLine:10};n.addListener("preference-changed",function(e,n,r){t.isUndefined(i[n])||(i[n]=r)});var a=function(){var e={},n=0;return{create:function(r){var i={label:"format-filter"+n++,filter:this.filter};return e[i.label]=i,r&&t.extend(i,r),i},filter:function(){},getFilteredData:function(t){var e=this.getFormatByName(t);return r.applyFormat(e,"filter"),e.getData()},getFormatByName:function(t){return e[t]||e}}}();a.create({label:"调用次数最多的函数列表",filteredData:[],filter:function(t,e){this.filteredData.push([t,e.runtime.length])},getData:function(){var t={header:[["函数名称",75],["调用次数",25]],data:this.filteredData.sort(function(t,e){return e[1]-t[1]})};return this.filteredData=[],t}}),a.create({label:"平均耗时最多的函数列表",filteredData:[],filter:function(e,n){var r=n.runtime,i=t.sumArray(r);this.filteredData.push([e,i>0?t.formatDecimal(i/r.length,2):0])},getData:function(){var t={header:[["函数名称",75],["平均耗时(ms)",25]],data:this.filteredData.sort(function(t,e){return e[1]-t[1]})};return this.filteredData=[],t}}),a.create({label:"单次调用耗时最长的函数列表",filteredData:[],filter:function(e,n){this.filteredData.push([e,t.getMaxFromArray(n.runtime)])},getData:function(){var t={header:[["函数名称",75],["耗时(ms)",25]],data:this.filteredData.sort(function(t,e){return e[1]-t[1]})};return this.filteredData=[],t}});var o={formatHTML:function(e){var n,r,a=[];return(n=e.data).length>0&&(a.push("<table>"),(r=e.header).length>0&&(a.push("<tr>"),t.each(r,function(t){a.push("<th"+(t[1]?" width="+t[1]+"%":"")+">"+t[0]+"</th>")}),a.push("</tr>")),t.each(n.slice(0,i.displayMaxLine),function(e){a.push("<tr>"),t.each(e,function(t){a.push("<td>"+t+"</td>")}),a.push("</tr>")})),a.join("")}},u=function(){var i='<div class="zoptimizer-header"><span id="zoptimizer-winToggle"></span>ZOptimizer让脚本运行时更高效！</div><div class="zoptimizer-content-wrap" id="zoptimizer-searchbar"><label forid="zoptimizer-data-input">监测对象：</label><input id="zoptimizer-data-input" class="zoptimizer-comp" type="text" placeholder="输入要监测的对象" /><input type="button" class="zoptimizer-comp" id="zoptimizer-input-confirm" value="确定" /></div><div id="zoptimizer-dataset"><div class="zoptimizer-content-wrap" id="zoptimizer-filterbar">筛选方式：<select id="zoptimizer-filter-type" class="zoptimizer-comp"></select></div><div class="zoptimizer-content-wrap" id="zoptimizer-resultbar"></div></div>',u=[".zoptimizer-wrapper{text-align:left;position:fixed;right:0;bottom:0;border:1px solid #666;width:330px;font-size:12px;line-height:1.8;background-color:#fff;color:#333;overflow:hidden;z-index:9999999}",".zoptimizer-wrapper *{padding:0;margin:0;}",".zoptimizer-wrapper .minimize{display:block;float:right;margin:10px 10px 0 0;width:20px;height:3px;border:5px solid #666;background-color:#fff;cursor:pointer;}",".zoptimizer-wrapper .maximize{display:block;float:right;width:20px;height:8px;margin:10px 10px 0 0;border:2px solid #fff;cursor:pointer;}",".zoptimizer-wrapper input{vertical-align:top;}",".zoptimizer-wrapper select{vertical-align:top;}",".zoptimizer-header{background-color:#666;height:36px;color:#fff;font:600 14px/2.5 georgia, arial, sans-serif;text-indent:1em;}",".zoptimizer-content-wrap{padding:10px 6px;}",".zoptimizer-comp{border:1px solid #666;background-color:#fff;color:#333;}","#zoptimizer-dataset{display:none;}","#zoptimizer-data-input{width:190px;height:20px;}","#zoptimizer-input-confirm:hover{color:#fff;background-color:#666;}","#zoptimizer-input-confirm{width:50px;height:22px;cursor:pointer;margin-left:10px;}","#zoptimizer-filter-type{height:22px;width:190px;}","#zoptimizer-resultbar table{border:1px solid #d3d2d2;border-collapse:collapse;width:100%;table-layout:fixed;}","#zoptimizer-resultbar th{text-align:center;height:26px;line-height:26px;background-color:#f3f2f2;word-break;break-all;word-wrap:break-word;border:1px solid #d3d2d2;}","#zoptimizer-resultbar td{text-align:left;padding:0 4px;word-break;break-all;word-wrap:break-word;border:1px solid #d3d2d2;}"];return e.create({init:function(e){var n=this;t.domReady(function(){var r=n.wrap=document.createElement("div"),a=t.$;r.className="zoptimizer-wrapper",r.id="zoptimizer",r.innerHTML=i,document.body.appendChild(r),t.injectCSS2Page(u),n.dataInput=a("zoptimizer-data-input"),n.inputConfirm=a("zoptimizer-input-confirm"),n.filterType=a("zoptimizer-filter-type"),n.filterResult=a("zoptimizer-resultbar"),n.datasetWrap=a("zoptimizer-dataset"),n.winToggle=a("zoptimizer-winToggle"),t.DomEvent.on(n.inputConfirm,"click",function(){n.startCheck(n.dataInput.value,n.filterType.value)}),t.DomEvent.on(n.dataInput,"keydown",function(e){13===e.keyCode&&t.trim(n.dataInput.value)&&n.startCheck(n.dataInput.value,n.filterType.value)}),n.setFilterTypes(e)})},startCheck:function(e,i){if(this.datasetWrap.style.display="block",this.dataInput.parentNode.replaceChild(document.createTextNode(this.dataInput.value),this.dataInput),this.inputConfirm.style.display="none",n.check(e),this.filterTypeChange(i),r.getFuncInfosLength()>0){this.winToggle.className="minimize";var a=this;t.DomEvent.on(this.winToggle,"click",function(){"minimize"===this.className?(a.datasetWrap.style.display="none",this.className="maximize"):(a.datasetWrap.style.display="block",this.className="minimize",a.filterTypeChange(a.filterType.value))})}},setFilterTypes:function(e){var n,r=this.filterType,i=document.createDocumentFragment(),a=this;t.foreach(e,function(t,e){n=document.createElement("option"),n.innerHTML=e.label,n.value=t,i.appendChild(n)}),r.appendChild(i),t.DomEvent.on(r,"change",function(){this.disabled=!0,a.filterTypeChange(this.value),this.disabled=!1})},filterTypeChange:function(t){"none"!==this.datasetWrap.style.display&&(this.filterResult.innerHTML=o.formatHTML(a.getFilteredData(t))||"暂无结果")}})}();u.init(a.getFormatByName()),n.addListener("after-function-exec",function(){var t;return function(){t&&window.clearTimeout(t),t=setTimeout(function(){u.filterTypeChange(u.filterType.value)},50)}}())}();